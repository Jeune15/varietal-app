function toggleFullScreen(){"use strict";document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}!function(e){"use strict";function t(e){return"string"==typeof e?"en"===d?e:f[e]||e:"en"===d?e.data[e.name]:e.data[e.name+"_"+d]||e.data[e.name]}function a(e){return.299*e.r+.587*e.g+.114*e.b}function n(e){return e.colour||i}function l(e){return n(e)}function r(e){return u}function o(e){return a(d3.rgb(e))<200?"#fff":"#333"}function c(e){return e.depth===h?a(d3.rgb(n(e)))<160?n(e):d3.rgb(n(e)).darker(2):o(n(e))}var u,i="#fff",s={Aroma:"Аромат",Flavor:"Вкус",Start:"Начало","Category without definition. Choose subcategory.":"Категория без определения. Выберите подкатегорию.",Close:"Закрыть"},d=e.lang||"ru",m=e.path||"/flavor-wheel/scaa-2.json",h=e.maxDepth||3,f=e.translations||s,p=d3.select("#legend").html();e.drawFlavorWheel=function(e){$("svg").empty();var a=840,n=a/2,i=d3.scale.linear().range([0,2*Math.PI]),s=d3.scale.pow().exponent(1.3).domain([0,1]).range([0,n]),m=5,f=d3.select("#wheel"),v=f.append("svg").attr("width",a-30).attr("height",a-30).append("g").attr("transform","translate("+[n-30,n-30]+")"),g=d3.layout.partition().sort(null).value(function(e){return 5.8-e.depth}),b=d3.svg.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,i(e.x)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,i(e.x+e.dx)))}).innerRadius(function(e){return Math.max(0,e.y?s(e.y):e.y)}).outerRadius(function(e){return Math.max(0,e.depth===h?s(e.y+e.dy)-110:s(e.y+e.dy))});d3.json(e,function(e,a){function n(e){var t;return e.parent?(t=n(e.parent),t.push(e)):t=[e],t}function f(e){if(e){var a=n(e);j.breadcrumbs=a,j.children=e.children;var l=function(a){var n=' <a class="close-reveal-modal show-for-small-only" aria-label="Закрыть" style="color:'+o(a.colour)+'">×</a>';if(0===a.depth){var l='<i class="button-icon hide-for-small-only"></i>';return a.depth===e.depth?l+n:l}return a.depth===e.depth?"&nbsp"+n:t({data:a,name:"name"})},r=a.length;a=a.map(function(t){return['<li class="level',t.depth,t.depth===e.depth?" current":"",'" ><a href="#" style="background-color:',t.colour||"#333",'" navigation-level-',t.depth,">",l(t),'<span class="after" style="border-left-color:',t.colour,'"></span></a></li>'].join("")}).join(""),a=['<ul class="breadcrumb items',r,'">',a,"</ul>"].join("");var c="";e.children&&(c=e.children.map(function(e,a){return['<a class="tiny button radius" href="#" sub-level-',a,' style="background-color:',e.colour,";color:",o(e.colour),'">',t({data:e,name:"name"}),"</a>"].join("")}).join(" ")+"<br><br>");var u="";e.image,1;var i="";e.icon,1;var s="en"===d?"":[' <span class="small">[',e.name||"Start","]</span>"].join("");d3.select("#legend").html([a,'<div class="submenu level',e.depth,'" style="border-color:',e.colour,'">','<div class="name" style="background-color:',e.colour||"#333",'"><h1 style="color:',o(e.colour),'">',i,t({data:e,name:"name"})||t("Start"),s,"</h1>",'<a class="close-reveal-modal hide-for-small-only" aria-label="Закрыть" style="color:',o(e.colour),'">&#215;</a>',"</div>",'<div class="detail-content">',c,u,p,"</div></div>"].join(""));var m=t({data:e,name:"definition"});if(m?d3.select("#legend p").text(m):d3.select("#legend p").text(t("Category without definition. Choose subcategory.")),e.references){var h=e.references.map(function(e){return e.aroma&&e.flavor?["<tr>","<td>",t({data:e,name:"reference"}),"</td>","<td>",t("Aroma"),":&nbsp;",e.aroma.toFixed(1),"</td>","<td>",t({data:e,name:"aroma_preparation"}),"</td>","</tr><tr>","<td></td>","<td>",t("Flavor"),":&nbsp;",e.flavor.toFixed(1),"</td>","<td>",t({data:e,name:"flavor_preparation"}),"</td>","</tr>"].join(""):e.aroma?["<tr>","<td>",t({data:e,name:"reference"}),"</td>","<td>",t("Aroma"),":&nbsp;",e.aroma.toFixed(1),"</td>","<td>",t({data:e,name:"aroma_preparation"}),"</td>","</tr>"].join(""):e.flavor?["<tr>","<td>",t({data:e,name:"reference"}),"</td>","<td>",t("Flavor"),":&nbsp;",e.flavor.toFixed(1),"</td>","<td>",t({data:e,name:"flavor_preparation"}),"</td>","</tr>"].join(""):void 0}).join("");d3.select("#legend table tbody").html(h),d3.select("#legend table").style("display","table")}else d3.select("#legend table").style("display","none"),d3.select("#legend table tbody").html("")}}function y(e){f(e),$("#detail").foundation("reveal","open")}h=a.meta.maxDepth||h,u=a.meta.strokeColor;var w=$("#info");if(w.length){var F=["<h3>",a.meta.name,"</h3>",'<p><a href="',a.meta.source,'" target="_blank">source</a></p>'];a.meta.notes&&a.meta.notes.forEach(function(e){F.push("<p>"),F.push(e),F.push("</p>")}),w.html(F.join(""))}var j={};$("#detail").off("click",".level0").on("click",".level0",function(){return f(j.breadcrumbs[0]),!1}),$("#detail").off("click","[navigation-level-1]").on("click","[navigation-level-1]",function(){return f(j.breadcrumbs[1]),!1}),$("#detail").off("click","[navigation-level-2]").on("click","[navigation-level-2]",function(){return f(j.breadcrumbs[2]),!1}),$("#detail").off("click","[navigation-level-3]").on("click","[navigation-level-3]",function(){return!1});for(var x=function(e){return function(){return f(j.children[e]),!1}},k=0;k<15;k++)$("#detail").off("click","[sub-level-"+k+"]").on("click","[sub-level-"+k+"]",x(k));var A=g.nodes({children:a.data}),C=v.selectAll("path").data(A);C.enter().append("path").attr("id",function(e,t){return"path-"+t}).attr("d",b).style("fill",l).style("stroke",r).on("click",y);var E=v.selectAll("text").data(A),W=E.enter().append("text").style("fill-opacity",1).style("fill",c).attr("text-anchor",function(e){return i(e.x+e.dx/2)>Math.PI?"end":"start"}).attr("dy",".2em").attr("transform",function(e){var t=180*i(e.x+e.dx/2)/Math.PI-90,a=t+(t>-90&&t<90?.5:-.5),n=e.depth===h?20:5;return"rotate("+a+")translate("+(s(e.y)+m+n)+")rotate("+(t>90?-180:0)+")"}).on("click",y);W.append("tspan").attr("x",0).text(function(e){return e.depth?t({data:e,name:"name"}):""})})},e.drawFlavorWheel(m);var v=$(".flavor-wheels-navigation");if(v.length){var g,b=[{path:"/flavor-wheel/scaa-1.json",name:"SCAA 1995"},{path:"/flavor-wheel/scaa-1-faults.json",name:"SCAA 1995 faults"},{path:"/flavor-wheel/counter-culture.json",name:"Counter culture 2013"},{path:"/flavor-wheel/counter-culture-faults.json",name:"Counter culture 2013 faults"},{path:"/flavor-wheel/scaa-2.json",name:"SCAA 2016"},{path:"/flavor-wheel/scaa-2-other.json",name:"SCAA 2016 other"},{path:"/flavor-wheel/angelscup.json",name:"Angelscup"},{path:"/flavor-wheel/beer.json",name:"The Meilgaard Beer Flavor Wheel"},{path:"/flavor-wheel/cheese.json",name:"Cheese Flavor Wheel"},{path:"/flavor-wheel/chedar.json",name:"The Cheddar Cheese Lexicon"},{path:"/flavor-wheel/chocolate.json",name:"Sensory Analysis of Chocolate Liquor"},{path:"/flavor-wheel/chocolate-mont-blanc.json",name:"Mont Blanc Gourmet Chocolate Tasting Wheel"},{path:"/flavor-wheel/fermentation.json",name:"Fermentation Flavor Wheel"},{path:"/flavor-wheel/high-impact-aroma-chemicals.json",name:"Flavour Wheel for high impact aroma chemicals"},{path:"/flavor-wheel/wine.json",name:"A.C. Noble Wine Aroma Wheel 2002"},{path:"/flavor-wheel/wine-2.json",name:"Winefolly Wine Aroma Wheel"},{path:"/flavor-wheel/wine-aromamaster.json",name:"Aromaster Wine Aroma Wheel (88 aromas)"},{path:"/flavor-wheel/cigar.json",name:"Cigar Flavors Wheel"},{path:"/flavor-wheel/maple-syrup.json",name:"Flavour Wheel for Maple Products"}];v.html(""),b.forEach(function(t){g=$("<li><a>"+t.name+"</a></li>"),g.on("click",function(a){e.drawFlavorWheel(t.path),a.preventDefault()}),v.append(g)})}}("undefined"==typeof nbc?{}:nbc),$(".full-screen").on("click",function(){"use strict";return toggleFullScreen(),!1});